<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TON Gift Trader</title>
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
</head>
<body>
  <h1>TON Gift Trader</h1>

  <!-- Кнопка подключения TON-кошелька -->
  <div id="ton-connect"></div>

  <h2>Твои активы:</h2>
  <div id="assets">Подключите кошелёк для отображения...</div>

  <script>
    const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
      manifestUrl: "https://guity777.github.io/telegram-ton-trader/tonconnect-manifest.json",
      buttonRootId: "ton-connect"
    });

    const apiKey = "AGD7ZA3LOFUOJ6YAAAAJRV5DMBGYW6YP3BZJCNENVT6MJCA63K4PGA4KW5BM7DD5YVKBY7Q"; // ← сюда вставь API-ключ от tonapi.io

    async function fetchUserAssets(address) {
      try {
        const res = await fetch(`https://tonapi.io/v2/accounts/${address}/nfts`, {
          headers: {
            Authorization: `Bearer ${apiKey}`,
          },
        });

        const data = await res.json();
        const assetsContainer = document.getElementById("assets");

        assetsContainer.innerHTML = ""; // очищаем

        if (data.nft_items && data.nft_items.length > 0) {
          data.nft_items.forEach(nft => {
            const card = document.createElement("div");
            card.style.border = "1px solid #ccc";
            card.style.borderRadius = "8px";
            card.style.padding = "10px";
            card.style.marginBottom = "10px";
            card.style.maxWidth = "200px";

            card.innerHTML = `
              <img src="${nft.preview?.url || ''}" width="100%" alt="NFT Preview"><br>
              <strong>${nft.metadata?.name || "Без названия"}</strong><br>
              <code style="font-size: 12px;">${nft.address}</code>
            `;

            assetsContainer.appendChild(card);
          });
        } else {
          assetsContainer.innerHTML = "<p>Нет активов</p>";
        }

      } catch (err) {
        console.error("Ошибка при получении активов:", err);
        document.getElementById("assets").innerHTML = "<p>Ошибка при получении активов</p>";
      }
    }

    tonConnectUI.onStatusChange(wallet => {
      if (wallet) {
        const userAddress = wallet.account.address;
        fetchUserAssets(userAddress);
      }
    });
  </script>
</body>
</html>
